# Source code and Jupyter Notebooks

## Source code

On `tesseroid_density` we can find the new Python code to compute the gravity fields generated by tesseroids with variable density.
Because it's partially written in Cython language, it must be compiled in order to use it later. We can do this just by executing the Makefile:

```
cd tesseroid_density
make
```

The code can be imported now within Python as:

```
from tesseroid_density import tesseroid
```

A Tesseroid instance from Fatiando a Terra is needed to build the tesseroid model, thus we must import the following classes:

* For single tesseroid model:
  ```
  from fatiando.mesher import Tesseroid
  ```

* For tesseroid meshes:
  ```
  from fatiando.mesher import TesseroidMesh
  ```

See the Jupyter notebooks (and the Fatiando a Terra documentation) to learn how to build the tesseroid model, assign a density function to it and finally compute the desired gravity field.

## Jupyter Notebooks:

* [01-simple-example.ipynb](https://github.com/pinga-lab/tesseroid-variable-density/blob/master/code/01-simple-example.ipynb):
  It contains two example codes that performs the gravity fields calculation using a single tesseroid with variable density in depth and a mesh of tesseroid that mixes variable with constant densities.

* [02-spherical-shell-analytical-solutions.ipynb](https://github.com/pinga-lab/tesseroid-variable-density/blob/master/code/02-spherical-shell-analytical-solutions.ipynb):
  On this notebook we obtain the analytical solution for the gravity potential generated by a spherical shell with variable density in depth. We make use of SymPy to calculate the non trivial integrations.

* [03-linear-density-test.ipynb](https://github.com/pinga-lab/tesseroid-variable-density/blob/master/code/03-linear-density-test.ipynb):
  On this notebook we perform the distance-size ratio determination by comparing the gravity fields generated by a spherical shell with linear density with its corresponding analytical solution.

* [04-exponential-density-test.ipynb](https://github.com/pinga-lab/tesseroid-variable-density/blob/master/code/04-exponential-density-test.ipynb):
  On this notebook we perform the distance-size ratio determination by comparing the gravity fields generated by a spherical shell with exponential density with its corresponding analytical solution.
  We also perform an accuracy test of the adaptive discretization algorithm for various exponential densities and the delta ratio determination.

* [05-discontinuous-density-test.ipynb](https://github.com/pinga-lab/tesseroid-variable-density/blob/master/code/05-discontinuous-density-test.ipynb):
  On this notebook we perform the distance-size ratio and the delta ratio determination by comparing the gravity fields generated by a spherical shell with exponential density with its corresponding analytical solution.

* [06-speed-comparison.ipynb](https://github.com/pinga-lab/tesseroid-variable-density/blob/master/code/06-speed-comparison.ipynb):
  On this notebook we record the computation times of gravity fields for a single tesseroid model with homogeneous and with variable density.

* [07-neuquen-basin.ipynb](https://github.com/pinga-lab/tesseroid-variable-density/blob/master/code/07-neuquen-basin.ipynb):
  On this notebook we compute the gravity fields generated by a tesseroid model of the Neuquen sedimentary basin.

* [08-plot-figures.ipynb.ipynb](https://github.com/pinga-lab/tesseroid-variable-density/blob/master/code/08-plot-figures.ipynb.ipynb):
  On this notebook we produce the figures and save them in PDF files ready for publication.

The `Makefile` has a rule to convert all notebooks to PDF.
To convert, run the following in this directory:
    
```
$ make
```

## Other Files

* **quick_test.py:** Simple Python script that test the compilation of the code. It performs accuracy tests and asserts it's bellow the 0.1% threshold. Its execution may take some time.

* **tesseroid_relief.py:** Definition of TesseroidRelief class used to build the Neuquen basin tesseroid model. Written by [Leonardo Uieda (2016)](https://github.com/pinga-lab/paper-moho-inversion-tesseroids).
